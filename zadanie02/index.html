<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="author" content="Filip Kwiatkowski">
    <title>Memory Game</title>
    <style>
        .display{
            position: relative;
            margin-top: 80px;
            width: 100%;
            height: auto;
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
        }

        .mini{
            box-sizing: border-box;
            border: 1px solid deepskyblue;
            top: 50px;
            height: 100px;
            width: 100px;
            cursor: pointer;
            opacity: 1;
            transition: opacity .5s;
        }

        .mini img{
            width: 100%;
            height: 100%;
        }

        .found{
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <!-- (div#a$.mini[onclick="show(this)" data-index="$"]>img[src="img/img$.png"])*10 -->
    <button class="show" onclick="showAll()">Poka≈º wszystkie</button>
    <button class="hide" onclick="hide()">Zakryj</button>
    <button class="random" onclick="random()">Losuj</button>

    <div class="display">
        <div id="a1" class="mini" onclick="show(this)" data-index="0"><img src="img/img1.png" alt=""></div>
        <div id="a2" class="mini" onclick="show(this)" data-index="1"><img src="img/img2.png" alt=""></div>
        <div id="a3" class="mini" onclick="show(this)" data-index="2"><img src="img/img3.png" alt=""></div>
        <div id="a4" class="mini" onclick="show(this)" data-index="3"><img src="img/img4.png" alt=""></div>
        <div id="a5" class="mini" onclick="show(this)" data-index="4"><img src="img/img5.png" alt=""></div>
        <div id="a6" class="mini" onclick="show(this)" data-index="5"><img src="img/img6.png" alt=""></div>
        <div id="a7" class="mini" onclick="show(this)" data-index="6"><img src="img/img7.png" alt=""></div>
        <div id="a8" class="mini" onclick="show(this)" data-index="7"><img src="img/img8.png" alt=""></div>
        <div id="a9" class="mini" onclick="show(this)" data-index="8"><img src="img/img9.png" alt=""></div>
        <div id="a10" class="mini" onclick="show(this)" data-index="9"><img src="img/img10.png" alt=""></div>

    </div>

    <script>
        const backFace = 'img/backface.png';
        const display = document.querySelector('.display');
        const blocks = [...document.querySelectorAll('.mini')];
        let selected = null;
        let hideing = null;
        let isShow = true;

        (function initGame(){
            //Generate paris
            document.querySelectorAll('.mini').forEach((item, index) => {
                const clone = item.cloneNode(true);
                clone.setAttribute('data-pairid', item.id);
                clone.id = `a${blocks.length + 1}`;
                item.setAttribute('data-pairid', clone.id);
                display.appendChild(clone);
                blocks.push(clone);
            });
        })();

        const cloneBlocks = [...blocks].map(item => item.cloneNode(true));

        const hide = () => {
            if(hideing){
                clearTimeout(hideing);
                hideing = null;
            }

            blocks.forEach(item => item.firstChild.src = backFace);
            isShow = false;
            selected = null;
        };

        const showAll = () =>{
            if(hideing){
                clearTimeout(hideing);
                hideing = null;
            }

            blocks.forEach((item, index) =>{
                if(item.id === cloneBlocks[index].id){
                    item.firstChild.src = cloneBlocks[index].firstChild.src;
                }
            });

            selected = null;
        }

        const show = (item) =>{
            //if(item.firstChild.getAttribute('src') !== backFace){ return; }
            if(selected === item){ return; }

            if(hideing){
                clearTimeout(hideing);
                hide();
                hideing = null;
            }

            item.firstChild.src = cloneBlocks[item.getAttribute('data-index')].firstChild.src;

            if(!selected){
                selected = item;
                return;
            }

            if(selected.id === item.getAttribute('data-pairid')){
                selected.classList.add('found');
                item.classList.add('found');
            }
            else if(!isShow){
                hideing = setTimeout(hide, 1000);
            }

            selected = null;  
        }

        const generateUniqueRandomNumbers = (range) => {
            let arr = [];
            let resoult = [];

            for(let i = 0; i < range; i++){
                arr.push(i);
            }

            for(let i = 1; i <= range; i++){
                const random = Math.floor(Math.random() * (range - i));
                resoult.push(arr[random]);
                arr[random] = arr[range - i];
            }

            return resoult;
        }

        const random = () =>{
            if(hideing){
                clearTimeout(hideing);
                hideing = null;
            }

            selected = null;
            display.innerHTML = "";
            const randomNumbers = generateUniqueRandomNumbers(blocks.length);
            
            for(let random of randomNumbers){
                display.appendChild(blocks[random]);
            }
        }
    </script>
</body>
</html>